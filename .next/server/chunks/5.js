exports.id=5,exports.ids=[5],exports.modules={658:(t,e,n)=>{Promise.resolve().then(n.bind(n,4718))},8670:(t,e,n)=>{Promise.resolve().then(n.t.bind(n,2583,23)),Promise.resolve().then(n.t.bind(n,6840,23)),Promise.resolve().then(n.t.bind(n,8771,23)),Promise.resolve().then(n.t.bind(n,3225,23)),Promise.resolve().then(n.t.bind(n,9295,23)),Promise.resolve().then(n.t.bind(n,3982,23))},4718:(t,e,n)=>{"use strict";n.r(e),n.d(e,{NotificationProvider:()=>h,default:()=>m,useNotifications:()=>l});var s=n(5344),o=n(3729),i=n(8117);let a={getUserNotifications:async(t={})=>{let e={filter:t.filter||"all",priority:t.priority,type:t.type,page:t.page||1,limit:t.limit||20,sortBy:t.sortBy||"creado_en",sortOrder:t.sortOrder||"desc"};return(await i.x1.get("/notifications",e)).data.data},getUnreadCount:async()=>(await i.x1.get("/notifications/unread-count")).data.data,markAsRead:async t=>(await i.x1.put(`/notifications/${t}/read`)).data.data,markAllAsRead:async()=>(await i.x1.put("/notifications/mark-all-read")).data.data,createNotification:async t=>(await i.x1.post("/notifications",t)).data.data,deleteNotification:async t=>(await i.x1.delete(`/notifications/${t}`)).data.data,getUserPreferences:async()=>(await i.x1.get("/notifications/preferences")).data.data,updateUserPreferences:async t=>(await i.x1.put("/notifications/preferences",t)).data.data,getNotificationStats:async(t="week")=>(await i.x1.get("/notifications/stats",{period:t})).data.data,testNotification:async t=>(await i.x1.post("/notifications/test",t)).data.data,bulkMarkAsRead:async t=>(await i.x1.put("/notifications/bulk-read",{notificationIds:t})).data.data,bulkDelete:async t=>(await i.x1.post("/notifications/bulk-delete",{notificationIds:t})).data.data,getGroupedNotifications:async(t={})=>{let e={...t,grouped:!0};return(await i.x1.get("/notifications/grouped",e)).data.data}};class c{constructor(){this.socket=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3,this.heartbeatInterval=null,this.isConnecting=!1,this.listeners=new Map,this.setupHeartbeat()}connect(t){return new Promise((e,n)=>{if(this.isConnecting||this.socket&&this.socket.readyState===WebSocket.OPEN){e();return}this.isConnecting=!0;let s=t||localStorage.getItem("authToken");if(!s){n(Error("No authentication token available")),this.isConnecting=!1;return}let o=process.env.NEXT_PUBLIC_WS_URL||"ws://localhost:3002",i=`${o}/ws/notifications?token=${encodeURIComponent(s)}`;this.socket=new WebSocket(i),this.socket.onopen=()=>{console.log("Notification WebSocket connected"),this.reconnectAttempts=0,this.isConnecting=!1,this.emit("connected",{timestamp:new Date().toISOString()}),e()},this.socket.onclose=t=>{console.log("Notification WebSocket disconnected:",t.code,t.reason),this.isConnecting=!1,this.emit("disconnected",{code:t.code,reason:t.reason}),this.attemptReconnect()},this.socket.onerror=t=>{console.error("Notification WebSocket error:",t),this.isConnecting=!1,this.emit("error",{error:"WebSocket connection failed"}),n(Error("WebSocket connection failed")),this.attemptReconnect()},this.socket.onmessage=t=>{try{let e=JSON.parse(t.data);this.handleMessage(e)}catch(t){console.error("Error parsing WebSocket message:",t)}}})}handleMessage(t){switch(t.type){case"notification":this.emit("notification",t);break;case"notification_updated":this.emit("notification_updated",t);break;case"all_notifications_read":this.emit("all_notifications_read",t);break;case"pending_notifications":this.emit("pending_notifications",t);break;case"connection_established":this.emit("connection_established",t);break;case"pong":this.emit("pong",t);break;case"error":this.emit("error",t);break;default:console.log("Unknown WebSocket message type:",t.type)}}disconnect(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.socket&&(this.socket.close(),this.socket=null),this.reconnectAttempts=0,this.isConnecting=!1}sendMessage(t,e={}){if(this.socket&&this.socket.readyState===WebSocket.OPEN){let n=JSON.stringify({type:t,...e});this.socket.send(n)}else console.warn("WebSocket not connected, cannot send message:",t)}markAsRead(t){this.sendMessage("mark_as_read",{notificationId:t})}markAllAsRead(){this.sendMessage("mark_all_as_read")}ping(){this.sendMessage("ping",{timestamp:Date.now()})}get isConnected(){return this.socket?.readyState===WebSocket.OPEN}get connectionStatus(){return this.isConnecting?"connecting":this.isConnected?"connected":"disconnected"}on(t,e){this.listeners.has(t)||this.listeners.set(t,[]),this.listeners.get(t).push(e)}off(t,e){if(this.listeners.has(t)){if(e){let n=this.listeners.get(t),s=n.indexOf(e);s>-1&&n.splice(s,1)}else this.listeners.delete(t)}}emit(t,e){let n=this.listeners.get(t);n&&n.forEach(t=>{try{t(e)}catch(t){console.error("Error in WebSocket event listener:",t)}})}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached"),this.emit("error",{error:"Max reconnection attempts reached"});return}this.reconnectAttempts++,console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect().catch(t=>{console.error("Reconnection failed:",t)})},this.reconnectInterval*this.reconnectAttempts)}setupHeartbeat(){this.heartbeatInterval=setInterval(()=>{this.isConnected&&this.ping()},3e4)}reconnect(){return this.disconnect(),this.connect()}}let r=new c,d=(0,o.createContext)(void 0),l=()=>{let t=(0,o.useContext)(d);if(!t)throw Error("useNotifications must be used within NotificationProvider");return t},h=({children:t})=>{let[e,n]=(0,o.useState)([]),[i,c]=(0,o.useState)(0),[l,h]=(0,o.useState)(!1),[m,p]=(0,o.useState)(null),[u,f]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let t=localStorage.getItem("authToken");if(t)return(async()=>{try{await r.connect(t)}catch(t){console.error("Failed to connect WebSocket:",t)}})(),()=>{r.disconnect()}},[]),(0,o.useEffect)(()=>{let t=()=>{h(!0)},e=()=>{h(!1)},s=t=>{"notification"===t.type&&t.data&&(n(e=>[t.data,...e]),c(t=>t+1),"critical"===t.data.prioridad&&g(t.data.titulo,t.data.mensaje))},o=t=>{"marked_as_read"===t.action&&t.notificationId&&(n(e=>e.map(e=>e.id===t.notificationId?{...e,esta_leido:!0}:e)),c(t=>Math.max(0,t-1)))},i=()=>{n(t=>t.map(t=>({...t,esta_leido:!0}))),c(0)},a=t=>{t.notifications&&(n(t.notifications),c(t.unreadCount||0))};return r.on("connected",t),r.on("disconnected",e),r.on("notification",s),r.on("notification_updated",o),r.on("all_notifications_read",i),r.on("pending_notifications",a),()=>{r.off("connected",t),r.off("disconnected",e),r.off("notification",s),r.off("notification_updated",o),r.off("all_notifications_read",i),r.off("pending_notifications",a)}},[]);let g=(t,e)=>{"Notification"in window&&"granted"===Notification.permission&&new Notification(t,{body:e,icon:"/favicon.ico",badge:"/badge.png"})},w=(0,o.useCallback)(async(t={})=>{f(!0);try{let e=await a.getUserNotifications(t);return n(e.notifications),c(e.unreadCount),e}catch(t){throw console.error("Error fetching notifications:",t),t}finally{f(!1)}},[]),k=(0,o.useCallback)(async t=>{try{n(e=>e.map(e=>e.id===t?{...e,esta_leido:!0}:e)),c(t=>Math.max(0,t-1)),await a.markAsRead(t)}catch(t){throw console.error("Error marking notification as read:",t),await w(),t}},[w]),y=(0,o.useCallback)(async()=>{try{n(t=>t.map(t=>({...t,esta_leido:!0}))),c(0),await a.markAllAsRead()}catch(t){throw console.error("Error marking all as read:",t),await w(),t}},[w]),b=(0,o.useCallback)(async(t,e,s={})=>{try{let o={id:Date.now().toString(),usuario_id:"current-user",tipo:t,prioridad:"medium",titulo:e,mensaje:e,metadata:s,esta_leido:!1,canales_enviados:["in_app"],fecha_envio:new Date().toISOString(),creado_en:new Date().toISOString()};return n(t=>[o,...t]),c(t=>t+1),o}catch(t){throw console.error("Error creating notification:",t),t}},[]),S=(0,o.useCallback)(async()=>{try{let t=await a.getUserPreferences();return p(t),t}catch(t){throw console.error("Error fetching preferences:",t),t}},[]),_=(0,o.useCallback)(async t=>{try{let e=await a.updateUserPreferences(t);return p(e),e}catch(t){throw console.error("Error updating preferences:",t),t}},[]);return s.jsx(d.Provider,{value:{notifications:e,unreadCount:i,isConnected:l,preferences:m,loading:u,fetchNotifications:w,markAsRead:k,markAllAsRead:y,createNotification:b,fetchPreferences:S,updatePreferences:_,wsConnected:l},children:t})},m=h},8117:(t,e,n)=>{"use strict";n.d(e,{CZ:()=>r,ST:()=>i,aU:()=>a,x1:()=>o});let s=n(1934).Z.create({baseURL:process.env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api",timeout:1e4,headers:{"Content-Type":"application/json"}});s.interceptors.request.use(t=>{let e=localStorage.getItem("authToken");return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t)),s.interceptors.response.use(t=>t,t=>(t.response?.status===401&&(localStorage.removeItem("authToken"),window.location.href="/login"),Promise.reject(t)));let o={get:(t,e)=>s.get(t,{params:e}),post:(t,e,n)=>s.post(t,e,n),put:(t,e)=>s.put(t,e),delete:t=>s.delete(t),patch:(t,e)=>s.patch(t,e)},i={createPreference:(t,e)=>o.post("/payments/create-preference",{serviceId:t,amount:e}),getClientPayments:t=>o.get(`/payments/${t}`),getPaymentStatus:t=>o.get(`/payments/status/${t}`),generateReceipt:t=>o.get(`/payments/receipt/${t}`),downloadReceipt:t=>s.get(`/payments/receipts/${t}`,{responseType:"blob"}),getProfessionalPayments:t=>o.get(`/payments/received/${t}`),withdrawFunds:(t,e)=>o.post("/payments/withdraw",{amount:t,bankDetails:e}),getAllPayments:t=>o.get("/admin/payments",t),releaseFunds:(t,e)=>o.post("/admin/payments/release-funds",{paymentId:t,serviceId:e})},a={getSettings:()=>o.get("/commissions"),getApplicableCommission:t=>o.get("/commissions/applicable",{serviceType:t}),createSetting:t=>o.post("/commissions",t),updateSetting:(t,e)=>o.put(`/commissions/${t}`,e),deactivateSetting:t=>o.delete(`/commissions/${t}`),calculateCommission:(t,e)=>o.post("/commissions/calculate",{amount:t,serviceType:e}),getStats:()=>o.get("/commissions/stats"),updateGlobalCommission:(t,e)=>o.post("/admin/commission/update",{percentage:t,minimumFee:e})};class c{connect(t){let e=process.env.NEXT_PUBLIC_WS_URL||"ws://localhost:3001";this.ws=new WebSocket(`${e}?userId=${t}`),this.ws.onopen=()=>{console.log("Payment WebSocket connected"),this.reconnectAttempts=0},this.ws.onmessage=t=>{try{let e=JSON.parse(t.data);this.handleMessage(e)}catch(t){console.error("Error parsing WebSocket message:",t)}},this.ws.onclose=()=>{console.log("Payment WebSocket disconnected"),this.attemptReconnect(t)},this.ws.onerror=t=>{console.error("Payment WebSocket error:",t)}}attemptReconnect(t){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,console.log(`Attempting to reconnect... (${this.reconnectAttempts}/${this.maxReconnectAttempts})`),setTimeout(()=>{this.connect(t)},this.reconnectInterval))}handleMessage(t){switch(t.type){case"payment_status_update":window.dispatchEvent(new CustomEvent("paymentStatusUpdate",{detail:t}));break;case"payout_processed":window.dispatchEvent(new CustomEvent("payoutProcessed",{detail:t}));break;case"commission_updated":window.dispatchEvent(new CustomEvent("commissionUpdated",{detail:t}));break;default:console.log("Unknown WebSocket message type:",t.type)}}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}send(t){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(t))}constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3}}let r=new c},7968:(t,e,n)=>{"use strict";n.r(e),n.d(e,{default:()=>m,metadata:()=>h});var s=n(5036),o=n(265),i=n.n(o);n(7272);var a=n(6843);let c=(0,a.createProxy)(String.raw`d:\modificaciones-front\context\NotificationContext.tsx`),{__esModule:r,$$typeof:d}=c;c.default,(0,a.createProxy)(String.raw`d:\modificaciones-front\context\NotificationContext.tsx#useNotifications`);let l=(0,a.createProxy)(String.raw`d:\modificaciones-front\context\NotificationContext.tsx#NotificationProvider`),h={title:"Chang\xe1net - Pagos y Comisiones",description:"Sistema de pagos integrados y gesti\xf3n de comisiones para Chang\xe1net"};function m({children:t}){return s.jsx("html",{lang:"es",children:s.jsx("body",{className:i().className,children:s.jsx(l,{children:t})})})}},7272:()=>{}};