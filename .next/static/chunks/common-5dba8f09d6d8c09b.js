"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[592],{7929:function(e,t,n){n.d(t,{X:function(){return s},bZ:function(){return r}});var o=n(7437),a=n(2265),i=n(1657);let r=a.forwardRef((e,t)=>{let{className:n,variant:a="default",...r}=e;return(0,o.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground","destructive"===a?"border-red-500/50 text-red-700 bg-red-50 [&>svg]:text-red-700":"bg-background text-foreground",n),...r})});r.displayName="Alert",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",n),...a})}).displayName="AlertTitle";let s=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",n),...a})});s.displayName="AlertDescription"},5754:function(e,t,n){n.d(t,{z:function(){return r}});var o=n(7437),a=n(2265),i=n(5195);let r=a.forwardRef((e,t)=>{let{className:n,variant:a="default",size:r="default",...s}=e;return(0,o.jsx)("button",{className:(0,i.cn)("inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",{default:"bg-primary-600 text-white hover:bg-primary-700",destructive:"bg-danger-600 text-white hover:bg-danger-700",outline:"border border-gray-300 bg-white hover:bg-gray-50",secondary:"bg-secondary-100 text-secondary-900 hover:bg-secondary-200",ghost:"hover:bg-gray-100",link:"underline-offset-4 hover:underline text-primary-600"}[a],{default:"h-10 py-2 px-4",sm:"h-9 px-3 rounded-md",lg:"h-11 px-8 rounded-md",icon:"h-10 w-10"}[r],n),ref:t,...s})});r.displayName="Button"},7815:function(e,t,n){n.d(t,{Ol:function(){return s},SZ:function(){return d},Zb:function(){return r},aY:function(){return l},ll:function(){return c}});var o=n(7437),a=n(2265),i=n(5195);let r=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,i.cn)("rounded-lg border bg-card text-card-foreground shadow-soft",n),...a})});r.displayName="Card";let s=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,i.cn)("flex flex-col space-y-1.5 p-6",n),...a})});s.displayName="CardHeader";let c=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)("h3",{ref:t,className:(0,i.cn)("text-2xl font-semibold leading-none tracking-tight",n),...a})});c.displayName="CardTitle";let d=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)("p",{ref:t,className:(0,i.cn)("text-sm text-muted-foreground",n),...a})});d.displayName="CardDescription";let l=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,i.cn)("p-6 pt-0",n),...a})});l.displayName="CardContent",a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)("div",{ref:t,className:(0,i.cn)("flex items-center p-6 pt-0",n),...a})}).displayName="CardFooter"},5179:function(e,t,n){n.d(t,{I:function(){return r}});var o=n(7437),a=n(2265),i=n(5195);let r=a.forwardRef((e,t)=>{let{className:n,type:a,...r}=e;return(0,o.jsx)("input",{type:a,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...r})});r.displayName="Input"},3444:function(e,t,n){n.d(t,{g:function(){return r}});var o=n(7437),a=n(2265),i=n(1657);let r=a.forwardRef((e,t)=>{let{className:n,...a}=e;return(0,o.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",n),ref:t,...a})});r.displayName="Textarea"},7531:function(e,t,n){n.r(t),n.d(t,{NotificationProvider:function(){return f},default:function(){return m},useNotifications:function(){return u}});var o=n(7437),a=n(2265),i=n(826);let r={getUserNotifications:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={filter:e.filter||"all",priority:e.priority,type:e.type,page:e.page||1,limit:e.limit||20,sortBy:e.sortBy||"creado_en",sortOrder:e.sortOrder||"desc"};return(await i.x1.get("/notifications",t)).data.data},getUnreadCount:async()=>(await i.x1.get("/notifications/unread-count")).data.data,markAsRead:async e=>(await i.x1.put("/notifications/".concat(e,"/read"))).data.data,markAllAsRead:async()=>(await i.x1.put("/notifications/mark-all-read")).data.data,createNotification:async e=>(await i.x1.post("/notifications",e)).data.data,deleteNotification:async e=>(await i.x1.delete("/notifications/".concat(e))).data.data,getUserPreferences:async()=>(await i.x1.get("/notifications/preferences")).data.data,updateUserPreferences:async e=>(await i.x1.put("/notifications/preferences",e)).data.data,getNotificationStats:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"week";return(await i.x1.get("/notifications/stats",{period:e})).data.data},testNotification:async e=>(await i.x1.post("/notifications/test",e)).data.data,bulkMarkAsRead:async e=>(await i.x1.put("/notifications/bulk-read",{notificationIds:e})).data.data,bulkDelete:async e=>(await i.x1.post("/notifications/bulk-delete",{notificationIds:e})).data.data,getGroupedNotifications:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={...e,grouped:!0};return(await i.x1.get("/notifications/grouped",t)).data.data}};var s=n(2601);class c{connect(e){return new Promise((t,n)=>{if(this.isConnecting||this.socket&&this.socket.readyState===WebSocket.OPEN){t();return}this.isConnecting=!0;let o=e||localStorage.getItem("authToken");if(!o){n(Error("No authentication token available")),this.isConnecting=!1;return}let a=s.env.NEXT_PUBLIC_WS_URL||"ws://localhost:3002",i="".concat(a,"/ws/notifications?token=").concat(encodeURIComponent(o));this.socket=new WebSocket(i),this.socket.onopen=()=>{console.log("Notification WebSocket connected"),this.reconnectAttempts=0,this.isConnecting=!1,this.emit("connected",{timestamp:new Date().toISOString()}),t()},this.socket.onclose=e=>{console.log("Notification WebSocket disconnected:",e.code,e.reason),this.isConnecting=!1,this.emit("disconnected",{code:e.code,reason:e.reason}),this.attemptReconnect()},this.socket.onerror=e=>{console.error("Notification WebSocket error:",e),this.isConnecting=!1,this.emit("error",{error:"WebSocket connection failed"}),n(Error("WebSocket connection failed")),this.attemptReconnect()},this.socket.onmessage=e=>{try{let t=JSON.parse(e.data);this.handleMessage(t)}catch(e){console.error("Error parsing WebSocket message:",e)}}})}handleMessage(e){switch(e.type){case"notification":this.emit("notification",e);break;case"notification_updated":this.emit("notification_updated",e);break;case"all_notifications_read":this.emit("all_notifications_read",e);break;case"pending_notifications":this.emit("pending_notifications",e);break;case"connection_established":this.emit("connection_established",e);break;case"pong":this.emit("pong",e);break;case"error":this.emit("error",e);break;default:console.log("Unknown WebSocket message type:",e.type)}}disconnect(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.socket&&(this.socket.close(),this.socket=null),this.reconnectAttempts=0,this.isConnecting=!1}sendMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.socket&&this.socket.readyState===WebSocket.OPEN){let n=JSON.stringify({type:e,...t});this.socket.send(n)}else console.warn("WebSocket not connected, cannot send message:",e)}markAsRead(e){this.sendMessage("mark_as_read",{notificationId:e})}markAllAsRead(){this.sendMessage("mark_all_as_read")}ping(){this.sendMessage("ping",{timestamp:Date.now()})}get isConnected(){var e;return(null===(e=this.socket)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}get connectionStatus(){return this.isConnecting?"connecting":this.isConnected?"connected":"disconnected"}on(e,t){this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}off(e,t){if(this.listeners.has(e)){if(t){let n=this.listeners.get(e),o=n.indexOf(t);o>-1&&n.splice(o,1)}else this.listeners.delete(e)}}emit(e,t){let n=this.listeners.get(e);n&&n.forEach(e=>{try{e(t)}catch(e){console.error("Error in WebSocket event listener:",e)}})}attemptReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached"),this.emit("error",{error:"Max reconnection attempts reached"});return}this.reconnectAttempts++,console.log("Attempting to reconnect... (".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),setTimeout(()=>{this.connect().catch(e=>{console.error("Reconnection failed:",e)})},this.reconnectInterval*this.reconnectAttempts)}setupHeartbeat(){this.heartbeatInterval=setInterval(()=>{this.isConnected&&this.ping()},3e4)}reconnect(){return this.disconnect(),this.connect()}constructor(){this.socket=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3,this.heartbeatInterval=null,this.isConnecting=!1,this.listeners=new Map,this.setupHeartbeat()}}let d=new c,l=(0,a.createContext)(void 0),u=()=>{let e=(0,a.useContext)(l);if(!e)throw Error("useNotifications must be used within NotificationProvider");return e},f=e=>{let{children:t}=e,[n,i]=(0,a.useState)([]),[s,c]=(0,a.useState)(0),[u,f]=(0,a.useState)(!1),[m,p]=(0,a.useState)(null),[h,g]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=localStorage.getItem("authToken");if(e)return(async()=>{try{await d.connect(e)}catch(e){console.error("Failed to connect WebSocket:",e)}})(),()=>{d.disconnect()}},[]),(0,a.useEffect)(()=>{let e=()=>{f(!0)},t=()=>{f(!1)},n=e=>{"notification"===e.type&&e.data&&(i(t=>[e.data,...t]),c(e=>e+1),"critical"===e.data.prioridad&&b(e.data.titulo,e.data.mensaje))},o=e=>{"marked_as_read"===e.action&&e.notificationId&&(i(t=>t.map(t=>t.id===e.notificationId?{...t,esta_leido:!0}:t)),c(e=>Math.max(0,e-1)))},a=()=>{i(e=>e.map(e=>({...e,esta_leido:!0}))),c(0)},r=e=>{e.notifications&&(i(e.notifications),c(e.unreadCount||0))};return d.on("connected",e),d.on("disconnected",t),d.on("notification",n),d.on("notification_updated",o),d.on("all_notifications_read",a),d.on("pending_notifications",r),()=>{d.off("connected",e),d.off("disconnected",t),d.off("notification",n),d.off("notification_updated",o),d.off("all_notifications_read",a),d.off("pending_notifications",r)}},[]);let b=(e,t)=>{"Notification"in window&&"granted"===Notification.permission&&new Notification(e,{body:t,icon:"/favicon.ico",badge:"/badge.png"})},w=(0,a.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};g(!0);try{let t=await r.getUserNotifications(e);return i(t.notifications),c(t.unreadCount),t}catch(e){throw console.error("Error fetching notifications:",e),e}finally{g(!1)}},[]),y=(0,a.useCallback)(async e=>{try{i(t=>t.map(t=>t.id===e?{...t,esta_leido:!0}:t)),c(e=>Math.max(0,e-1)),await r.markAsRead(e)}catch(e){throw console.error("Error marking notification as read:",e),await w(),e}},[w]),v=(0,a.useCallback)(async()=>{try{i(e=>e.map(e=>({...e,esta_leido:!0}))),c(0),await r.markAllAsRead()}catch(e){throw console.error("Error marking all as read:",e),await w(),e}},[w]),k=(0,a.useCallback)(async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{let o={id:Date.now().toString(),usuario_id:"current-user",tipo:e,prioridad:"medium",titulo:t,mensaje:t,metadata:n,esta_leido:!1,canales_enviados:["in_app"],fecha_envio:new Date().toISOString(),creado_en:new Date().toISOString()};return i(e=>[o,...e]),c(e=>e+1),o}catch(e){throw console.error("Error creating notification:",e),e}},[]),x=(0,a.useCallback)(async()=>{try{let e=await r.getUserPreferences();return p(e),e}catch(e){throw console.error("Error fetching preferences:",e),e}},[]),S=(0,a.useCallback)(async e=>{try{let t=await r.updateUserPreferences(e);return p(t),t}catch(e){throw console.error("Error updating preferences:",e),e}},[]);return(0,o.jsx)(l.Provider,{value:{notifications:n,unreadCount:s,isConnected:u,preferences:m,loading:h,fetchNotifications:w,markAsRead:y,markAllAsRead:v,createNotification:k,fetchPreferences:x,updatePreferences:S,wsConnected:u},children:t})};var m=f},826:function(e,t,n){n.d(t,{CZ:function(){return l},ST:function(){return s},aU:function(){return c},x1:function(){return r}});var o=n(4829),a=n(2601);let i=o.Z.create({baseURL:a.env.NEXT_PUBLIC_API_URL||"http://localhost:3001/api",timeout:1e4,headers:{"Content-Type":"application/json"}});i.interceptors.request.use(e=>{let t=localStorage.getItem("authToken");return t&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>Promise.reject(e)),i.interceptors.response.use(e=>e,e=>{var t;return(null===(t=e.response)||void 0===t?void 0:t.status)===401&&(localStorage.removeItem("authToken"),window.location.href="/login"),Promise.reject(e)});let r={get:(e,t)=>i.get(e,{params:t}),post:(e,t,n)=>i.post(e,t,n),put:(e,t)=>i.put(e,t),delete:e=>i.delete(e),patch:(e,t)=>i.patch(e,t)},s={createPreference:(e,t)=>r.post("/payments/create-preference",{serviceId:e,amount:t}),getClientPayments:e=>r.get("/payments/".concat(e)),getPaymentStatus:e=>r.get("/payments/status/".concat(e)),generateReceipt:e=>r.get("/payments/receipt/".concat(e)),downloadReceipt:e=>i.get("/payments/receipts/".concat(e),{responseType:"blob"}),getProfessionalPayments:e=>r.get("/payments/received/".concat(e)),withdrawFunds:(e,t)=>r.post("/payments/withdraw",{amount:e,bankDetails:t}),getAllPayments:e=>r.get("/admin/payments",e),releaseFunds:(e,t)=>r.post("/admin/payments/release-funds",{paymentId:e,serviceId:t})},c={getSettings:()=>r.get("/commissions"),getApplicableCommission:e=>r.get("/commissions/applicable",{serviceType:e}),createSetting:e=>r.post("/commissions",e),updateSetting:(e,t)=>r.put("/commissions/".concat(e),t),deactivateSetting:e=>r.delete("/commissions/".concat(e)),calculateCommission:(e,t)=>r.post("/commissions/calculate",{amount:e,serviceType:t}),getStats:()=>r.get("/commissions/stats"),updateGlobalCommission:(e,t)=>r.post("/admin/commission/update",{percentage:e,minimumFee:t})};class d{connect(e){let t=a.env.NEXT_PUBLIC_WS_URL||"ws://localhost:3001";this.ws=new WebSocket("".concat(t,"?userId=").concat(e)),this.ws.onopen=()=>{console.log("Payment WebSocket connected"),this.reconnectAttempts=0},this.ws.onmessage=e=>{try{let t=JSON.parse(e.data);this.handleMessage(t)}catch(e){console.error("Error parsing WebSocket message:",e)}},this.ws.onclose=()=>{console.log("Payment WebSocket disconnected"),this.attemptReconnect(e)},this.ws.onerror=e=>{console.error("Payment WebSocket error:",e)}}attemptReconnect(e){this.reconnectAttempts<this.maxReconnectAttempts&&(this.reconnectAttempts++,console.log("Attempting to reconnect... (".concat(this.reconnectAttempts,"/").concat(this.maxReconnectAttempts,")")),setTimeout(()=>{this.connect(e)},this.reconnectInterval))}handleMessage(e){switch(e.type){case"payment_status_update":window.dispatchEvent(new CustomEvent("paymentStatusUpdate",{detail:e}));break;case"payout_processed":window.dispatchEvent(new CustomEvent("payoutProcessed",{detail:e}));break;case"commission_updated":window.dispatchEvent(new CustomEvent("commissionUpdated",{detail:e}));break;default:console.log("Unknown WebSocket message type:",e.type)}}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}send(e){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(e))}constructor(){this.ws=null,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectInterval=3e3}}let l=new d},1657:function(e,t,n){n.d(t,{cn:function(){return i}});var o=n(7042),a=n(4769);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,o.W)(t))}},5195:function(e,t,n){n.d(t,{Dx:function(){return d},Ny:function(){return l},cn:function(){return i},o0:function(){return c},p6:function(){return s},xG:function(){return r}});var o=n(7042),a=n(4769);function i(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,a.m6)((0,o.W)(t))}function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"ARS";return new Intl.NumberFormat("es-AR",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function s(e){let t=new Date(e);return new Intl.DateTimeFormat("es-AR",{year:"numeric",month:"short",day:"numeric"}).format(t)}function c(e){let t=new Date(e);return new Intl.DateTimeFormat("es-AR",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(t)}function d(e){switch(e){case"pendiente":return"badge-warning";case"aprobado":default:return"badge-info";case"liberado":return"badge-success";case"rechazado":case"cancelado":return"badge-danger"}}function l(e){switch(e){case"pendiente":return"Pendiente";case"aprobado":return"Aprobado";case"liberado":return"Liberado";case"rechazado":return"Rechazado";case"cancelado":return"Cancelado";default:return e}}}}]);