(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[956],{4404:function(e,s,a){Promise.resolve().then(a.bind(a,7451))},7451:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return J}});var l=a(7437),t=a(2265),i=a(1865),r=a(7570),n=a(2160),c=a(7815),o=a(5754),d=a(5179),x=a(826),m=a(5195),u=a(3008),h=a(1738),p=a(1981),j=a(6264);let g=n.Ry({serviceId:n.Z_().min(1,"Debe seleccionar un servicio"),amount:n.Rx().min(1,"El monto debe ser mayor a 0").max(1e6,"Monto m\xe1ximo excedido")});function v(e){var s,a;let{service:n,onSuccess:v,onCancel:N}=e,[f,b]=(0,t.useState)(!1),[y,w]=(0,t.useState)(null),[C,k]=(0,t.useState)(null),[S,Z]=(0,t.useState)(null),{register:_,handleSubmit:z,watch:P,setValue:E,formState:{errors:M}}=(0,i.cI)({resolver:(0,r.F)(g),defaultValues:{serviceId:(null==n?void 0:n.id)||"",amount:(null==n?void 0:null===(a=n.profesional)||void 0===a?void 0:null===(s=a.perfil_profesional)||void 0===s?void 0:s.tarifa_hora)||0}}),A=P("amount");P("serviceId"),(0,t.useEffect)(()=>{A&&A>0&&G(A)},[A,G]),(0,t.useEffect)(()=>{if(null==n?void 0:n.id){var e,s;E("serviceId",n.id),(null===(s=n.profesional)||void 0===s?void 0:null===(e=s.perfil_profesional)||void 0===e?void 0:e.tarifa_hora)&&E("amount",n.profesional.perfil_profesional.tarifa_hora)}},[n,E]);let T=(0,t.useCallback)(async e=>{try{let s=await x.aU.calculateCommission(e,null==n?void 0:n.tipo_servicio);s.data.success&&w(s.data.data)}catch(e){console.error("Error calculating commission:",e)}},[null==n?void 0:n.tipo_servicio]),G=(0,t.useCallback)(function(e,s){let a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=null;return function(){for(var s=arguments.length,t=Array(s),i=0;i<s;i++)t[i]=arguments[i];let r=a&&!l;l&&clearTimeout(l),l=setTimeout(()=>{l=null,a||e(...t)},500),r&&e(...t)}}(T,500),[T]),I=async e=>{b(!0),Z(null);try{let s=await x.ST.createPreference(e.serviceId,e.amount);if(s.data.success){let e=s.data.data;k(e.init_point),window.open(e.init_point,"_blank"),v&&v(s.data.data.paymentId)}else Z(s.data.error||"Error al crear la preferencia de pago")}catch(e){var s,a;Z((null===(a=e.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.error)||"Error interno del servidor")}finally{b(!1)}};return C?(0,l.jsxs)(c.Zb,{className:"w-full max-w-md mx-auto",children:[(0,l.jsxs)(c.Ol,{className:"text-center",children:[(0,l.jsx)("div",{className:"mx-auto w-12 h-12 bg-success-100 rounded-full flex items-center justify-center mb-4",children:(0,l.jsx)(u.Z,{className:"w-6 h-6 text-success-600"})}),(0,l.jsx)(c.ll,{className:"text-success-800",children:"Pago Iniciado"}),(0,l.jsx)(c.SZ,{children:"Se ha abierto MercadoPago en una nueva ventana para completar el pago."})]}),(0,l.jsxs)(c.aY,{className:"space-y-4",children:[(0,l.jsxs)(o.z,{onClick:()=>window.open(C,"_blank"),className:"w-full",variant:"outline",children:[(0,l.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"Reabrir MercadoPago"]}),(0,l.jsx)(o.z,{onClick:N,variant:"ghost",className:"w-full",children:"Volver"})]})]}):(0,l.jsxs)(c.Zb,{className:"w-full max-w-md mx-auto",children:[(0,l.jsxs)(c.Ol,{children:[(0,l.jsxs)(c.ll,{className:"flex items-center",children:[(0,l.jsx)(h.Z,{className:"w-5 h-5 mr-2"}),"Checkout de Pago"]}),(0,l.jsx)(c.SZ,{children:"Complete los detalles para procesar el pago del servicio"})]}),(0,l.jsx)(c.aY,{children:(0,l.jsxs)("form",{onSubmit:z(I),className:"space-y-4",children:[n&&(0,l.jsxs)("div",{className:"p-4 bg-secondary-50 rounded-lg",children:[(0,l.jsx)("h4",{className:"font-medium text-secondary-900",children:n.descripcion}),(0,l.jsxs)("p",{className:"text-sm text-secondary-600",children:["Profesional: ",n.profesional.nombre]}),n.es_urgente&&(0,l.jsx)("p",{className:"text-sm text-warning-600 font-medium",children:"âš¡ Servicio urgente (+20% adicional)"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{htmlFor:"amount",className:"text-sm font-medium",children:"Monto a pagar"}),(0,l.jsx)(d.I,{id:"amount",type:"number",placeholder:"Ingrese el monto",..._("amount",{valueAsNumber:!0}),className:(0,m.cn)(M.amount&&"border-danger-500")}),M.amount&&(0,l.jsxs)("p",{className:"text-sm text-danger-600 flex items-center",children:[(0,l.jsx)(p.Z,{className:"w-4 h-4 mr-1"}),M.amount.message]})]}),y&&(0,l.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg space-y-2",children:[(0,l.jsx)("h4",{className:"font-medium text-sm",children:"Desglose del pago"}),(0,l.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,l.jsxs)("div",{className:"flex justify-between",children:[(0,l.jsx)("span",{children:"Monto base:"}),(0,l.jsx)("span",{children:(0,m.xG)(y.originalAmount)})]}),(0,l.jsxs)("div",{className:"flex justify-between text-danger-600",children:[(0,l.jsxs)("span",{children:["Comisi\xf3n (",y.commissionPercentage,"%):"]}),(0,l.jsxs)("span",{children:["-",(0,m.xG)(y.commissionAmount)]})]}),(0,l.jsx)("hr",{className:"my-2"}),(0,l.jsxs)("div",{className:"flex justify-between font-medium",children:[(0,l.jsx)("span",{children:"Total a pagar:"}),(0,l.jsx)("span",{children:(0,m.xG)(y.originalAmount)})]}),(0,l.jsxs)("div",{className:"flex justify-between text-success-600",children:[(0,l.jsx)("span",{children:"Profesional recibe:"}),(0,l.jsx)("span",{children:(0,m.xG)(y.professionalAmount)})]})]})]}),S&&(0,l.jsx)("div",{className:"p-4 bg-danger-50 border border-danger-200 rounded-lg",children:(0,l.jsxs)("p",{className:"text-sm text-danger-800 flex items-center",children:[(0,l.jsx)(p.Z,{className:"w-4 h-4 mr-2"}),S]})}),(0,l.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,l.jsx)(o.z,{type:"submit",disabled:f,className:"flex-1",children:f?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(j.Z,{className:"w-4 h-4 mr-2 animate-spin"}),"Procesando..."]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.Z,{className:"w-4 h-4 mr-2"}),"Pagar con MercadoPago"]})}),N&&(0,l.jsx)(o.z,{type:"button",variant:"outline",onClick:N,children:"Cancelar"})]})]})})]})}var N=a(2104),f=a(6141),b=a(4280),y=a(5817);function w(e){let{paymentId:s,onStatusChange:a,showActions:i=!0}=e,[r,n]=(0,t.useState)(null),[d,h]=(0,t.useState)(null),[g,v]=(0,t.useState)(!0),[w,C]=(0,t.useState)(!1),[k,S]=(0,t.useState)(null);(0,t.useEffect)(()=>{Z()},[s]),(0,t.useEffect)(()=>{let e=localStorage.getItem("userId");if(e){x.CZ.connect(e);let l=e=>{let l=e.detail;l.paymentId===s&&(h(l.status),a&&a(l.status),Z())};return window.addEventListener("paymentStatusUpdate",l),()=>{window.removeEventListener("paymentStatusUpdate",l),x.CZ.disconnect()}}},[s,a]);let Z=async()=>{try{C(!0);let e=await x.ST.getPaymentStatus(s);e.data.success?(n(e.data.data.payment),h(e.data.data),S(null)):S(e.data.error||"Error al cargar el estado del pago")}catch(s){var e,a;S((null===(a=s.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.error)||"Error interno del servidor")}finally{v(!1),C(!1)}},_=async()=>{try{let e=await x.ST.generateReceipt(s);e.data.success&&window.open(e.data.data.receiptUrl,"_blank")}catch(e){S("Error al generar el comprobante")}};return g?(0,l.jsx)(c.Zb,{className:"w-full max-w-md mx-auto",children:(0,l.jsxs)(c.aY,{className:"flex items-center justify-center py-8",children:[(0,l.jsx)(j.Z,{className:"w-6 h-6 animate-spin mr-2"}),(0,l.jsx)("span",{children:"Cargando estado del pago..."})]})}):k?(0,l.jsx)(c.Zb,{className:"w-full max-w-md mx-auto",children:(0,l.jsx)(c.aY,{className:"py-8",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(p.Z,{className:"w-12 h-12 text-danger-600 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-danger-800 mb-2",children:"Error"}),(0,l.jsx)("p",{className:"text-danger-600 mb-4",children:k}),(0,l.jsxs)(o.z,{onClick:Z,variant:"outline",children:[(0,l.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Reintentar"]})]})})}):d&&r?(0,l.jsxs)(c.Zb,{className:"w-full max-w-md mx-auto",children:[(0,l.jsxs)(c.Ol,{className:"text-center",children:[(0,l.jsx)("div",{className:"mx-auto mb-4",children:(e=>{switch(e){case"approved":return(0,l.jsx)(u.Z,{className:"w-6 h-6 text-success-600"});case"rejected":case"cancelled":return(0,l.jsx)(N.Z,{className:"w-6 h-6 text-danger-600"});case"pending":return(0,l.jsx)(f.Z,{className:"w-6 h-6 text-warning-600"});default:return(0,l.jsx)(p.Z,{className:"w-6 h-6 text-gray-600"})}})(d.status)}),(0,l.jsx)(c.ll,{className:"text-xl ".concat((0,m.Dx)(d.status)),children:(0,m.Ny)(d.status)}),(0,l.jsx)(c.SZ,{children:(e=>{switch(e){case"approved":return"Pago aprobado exitosamente";case"rejected":return"Pago rechazado";case"cancelled":return"Pago cancelado";case"pending":return"Pago pendiente de aprobaci\xf3n";default:return"Estado desconocido"}})(d.status)})]}),(0,l.jsxs)(c.aY,{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"ID de Pago:"}),(0,l.jsx)("span",{className:"text-sm font-mono",children:s})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"Monto:"}),(0,l.jsx)("span",{className:"text-sm font-medium",children:(0,m.xG)(r.monto_total)})]}),(0,l.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"Fecha:"}),(0,l.jsx)("span",{className:"text-sm",children:(0,m.o0)(r.creado_en)})]}),d.date_approved&&(0,l.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"Aprobado:"}),(0,l.jsx)("span",{className:"text-sm",children:(0,m.o0)(d.date_approved)})]}),r.commission_setting&&(0,l.jsxs)("div",{className:"flex justify-between items-center py-2 border-b",children:[(0,l.jsx)("span",{className:"text-sm text-gray-600",children:"Comisi\xf3n:"}),(0,l.jsxs)("span",{className:"text-sm",children:[r.commission_setting.porcentaje,"% (",(0,m.xG)(r.comision_plataforma),")"]})]})]}),r.servicio&&(0,l.jsxs)("div",{className:"p-3 bg-gray-50 rounded-lg",children:[(0,l.jsx)("h4",{className:"font-medium text-sm mb-1",children:"Servicio"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:r.servicio.descripcion}),(0,l.jsxs)("p",{className:"text-xs text-gray-500",children:["Profesional: ",r.servicio.profesional.nombre]})]}),i&&(0,l.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,l.jsxs)(o.z,{onClick:()=>Z(),disabled:w,variant:"outline",size:"sm",className:"flex-1",children:[w?(0,l.jsx)(j.Z,{className:"w-4 h-4 mr-2 animate-spin"}):(0,l.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Actualizar"]}),"approved"===d.status&&(0,l.jsxs)(o.z,{onClick:_,variant:"outline",size:"sm",className:"flex-1",children:[(0,l.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"Comprobante"]})]}),(0,l.jsxs)("div",{className:"flex items-center justify-center text-xs text-gray-500 pt-2",children:[(0,l.jsx)("div",{className:"w-2 h-2 bg-success-500 rounded-full mr-2 animate-pulse"}),"Actualizaci\xf3n en tiempo real"]})]})]}):(0,l.jsx)(c.Zb,{className:"w-full max-w-md mx-auto",children:(0,l.jsx)(c.aY,{className:"py-8",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(p.Z,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Pago no encontrado"}),(0,l.jsx)("p",{className:"text-gray-600",children:"No se pudo encontrar informaci\xf3n del pago"})]})})})}var C=a(8244),k=a(9224),S=a(3523);function Z(e){let{clientId:s,limit:a=10,showDetails:i=!0}=e,[r,n]=(0,t.useState)([]),[d,u]=(0,t.useState)(!0),[h,g]=(0,t.useState)(!1),[v,N]=(0,t.useState)(null),[f,w]=(0,t.useState)(null);(0,t.useEffect)(()=>{Z()},[s]);let Z=async()=>{try{g(!0);let e=await x.ST.getClientPayments(s);e.data.success?(n(e.data.data),N(null)):N(e.data.error||"Error al cargar el historial de pagos")}catch(s){var e,a;N((null===(a=s.response)||void 0===a?void 0:null===(e=a.data)||void 0===e?void 0:e.error)||"Error interno del servidor")}finally{u(!1),g(!1)}},_=async e=>{try{let s=await x.ST.generateReceipt(e);s.data.success&&window.open(s.data.data.receiptUrl,"_blank")}catch(e){N("Error al generar el comprobante")}},z=e=>{w(f===e?null:e)};return d?(0,l.jsx)(c.Zb,{className:"w-full",children:(0,l.jsxs)(c.aY,{className:"flex items-center justify-center py-8",children:[(0,l.jsx)(j.Z,{className:"w-6 h-6 animate-spin mr-2"}),(0,l.jsx)("span",{children:"Cargando historial de pagos..."})]})}):v?(0,l.jsx)(c.Zb,{className:"w-full",children:(0,l.jsx)(c.aY,{className:"py-8",children:(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)(p.Z,{className:"w-12 h-12 text-danger-600 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-danger-800 mb-2",children:"Error"}),(0,l.jsx)("p",{className:"text-danger-600 mb-4",children:v}),(0,l.jsxs)(o.z,{onClick:Z,variant:"outline",children:[(0,l.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Reintentar"]})]})})}):(0,l.jsxs)(c.Zb,{className:"w-full",children:[(0,l.jsx)(c.Ol,{children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsxs)(c.ll,{className:"flex items-center",children:[(0,l.jsx)(C.Z,{className:"w-5 h-5 mr-2"}),"Historial de Pagos"]}),(0,l.jsxs)(c.SZ,{children:[r.length," pago",1!==r.length?"s":""," realizado",1!==r.length?"s":""]})]}),(0,l.jsxs)(o.z,{onClick:Z,disabled:h,variant:"outline",size:"sm",children:[h?(0,l.jsx)(j.Z,{className:"w-4 h-4 mr-2 animate-spin"}):(0,l.jsx)(b.Z,{className:"w-4 h-4 mr-2"}),"Actualizar"]})]})}),(0,l.jsx)(c.aY,{children:0===r.length?(0,l.jsxs)("div",{className:"text-center py-8",children:[(0,l.jsx)(C.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay pagos"}),(0,l.jsx)("p",{className:"text-gray-600",children:"A\xfan no has realizado ning\xfan pago"})]}):(0,l.jsxs)("div",{className:"space-y-4",children:[r.slice(0,a).map(e=>{var s,a;return(0,l.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)("div",{className:"flex-shrink-0",children:(0,l.jsx)("div",{className:"w-3 h-3 rounded-full ".concat("liberado"===e.estado?"bg-success-500":"aprobado"===e.estado?"bg-primary-500":"pendiente"===e.estado?"bg-warning-500":"bg-danger-500")})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"text-sm font-medium text-gray-900",children:(null===(s=e.servicio)||void 0===s?void 0:s.descripcion)||"Servicio"}),(0,l.jsx)("p",{className:"text-xs text-gray-600",children:(0,m.p6)(e.creado_en)})]})]}),(0,l.jsxs)("div",{className:"text-right",children:[(0,l.jsx)("p",{className:"text-lg font-semibold",children:(0,m.xG)(e.monto_total)}),(0,l.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ".concat((0,m.Dx)(e.estado)),children:(0,m.Ny)(e.estado)})]})]}),i&&(0,l.jsxs)("div",{className:"mt-3",children:[(0,l.jsxs)(o.z,{onClick:()=>z(e.id),variant:"ghost",size:"sm",className:"w-full justify-between",children:[(0,l.jsx)("span",{children:"Ver detalles"}),f===e.id?(0,l.jsx)(k.Z,{className:"w-4 h-4"}):(0,l.jsx)(S.Z,{className:"w-4 h-4"})]}),f===e.id&&(0,l.jsxs)("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg space-y-2",children:[(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"ID de Pago:"}),(0,l.jsx)("p",{className:"font-mono text-xs",children:e.id})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Profesional:"}),(0,l.jsx)("p",{children:null===(a=e.servicio)||void 0===a?void 0:a.profesional.nombre})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Monto Total:"}),(0,l.jsx)("p",{className:"font-medium",children:(0,m.xG)(e.monto_total)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Comisi\xf3n:"}),(0,l.jsx)("p",{children:(0,m.xG)(e.comision_plataforma)})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Profesional Recibe:"}),(0,l.jsx)("p",{className:"font-medium text-success-600",children:(0,m.xG)(e.monto_profesional)})]}),e.commission_setting&&(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"text-gray-600",children:"Tasa de Comisi\xf3n:"}),(0,l.jsxs)("p",{children:[e.commission_setting.porcentaje,"%"]})]})]}),(0,l.jsx)("div",{className:"flex space-x-2 pt-3 border-t",children:(0,l.jsxs)(o.z,{onClick:()=>_(e.id),variant:"outline",size:"sm",disabled:"aprobado"!==e.estado&&"liberado"!==e.estado,children:[(0,l.jsx)(y.Z,{className:"w-4 h-4 mr-2"}),"Comprobante"]})})]})]})]},e.id)}),r.length>a&&(0,l.jsx)("div",{className:"text-center pt-4",children:(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["Mostrando ",a," de ",r.length," pagos"]})})]})})]})}var _=a(3067),z=a(3021),P=a(7531),E=a(1657),M=e=>{let{onClick:s,className:a,showBadge:i=!0,size:r="md"}=e,{unreadCount:n,isConnected:c}=(0,P.useNotifications)(),[o,d]=(0,t.useState)(!1);return(0,t.useEffect)(()=>{if(n>0){d(!0);let e=setTimeout(()=>d(!1),1e3);return()=>clearTimeout(e)}},[n]),(0,l.jsxs)("button",{onClick:()=>{s&&s()},className:(0,E.cn)("relative p-2 rounded-full hover:bg-gray-100 transition-colors","focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2",a),"aria-label":"Notificaciones ".concat(n>0?"(".concat(n," sin leer)"):""),children:[(0,l.jsx)(z.Z,{className:(0,E.cn)({sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"}[r],"transition-transform duration-200",o&&"animate-bounce",!c&&"text-gray-400")}),!c&&(0,l.jsx)("div",{className:"absolute -top-1 -right-1 w-2 h-2 bg-red-500 rounded-full"}),i&&n>0&&(0,l.jsx)("div",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full min-w-[18px] h-[18px] flex items-center justify-center font-medium",children:n>99?"99+":n}),n>0&&(0,l.jsx)("div",{className:"absolute inset-0 rounded-full bg-red-500 opacity-20 animate-ping"})]})},A=a(690),T=a(2549),G=a(2482),I=a(9409),H=e=>{let{isOpen:s,onClose:a,onOpenPreferences:i,className:r}=e,{notifications:n,unreadCount:c,loading:o,markAsRead:d,markAllAsRead:x,fetchNotifications:m}=(0,P.useNotifications)(),[u,h]=(0,t.useState)("all"),[p,j]=(0,t.useState)("all"),g=(0,t.useRef)(null);(0,t.useEffect)(()=>{let e=e=>{g.current&&!g.current.contains(e.target)&&a()};return s&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[s,a]),(0,t.useEffect)(()=>{s&&m({filter:u,priority:"all"===p?void 0:p})},[s,u,p,m]);let v=async e=>{try{await d(e)}catch(e){console.error("Failed to mark notification as read:",e)}},N=async()=>{try{await x()}catch(e){console.error("Failed to mark all notifications as read:",e)}},f=e=>{let s={critical:"border-red-500 bg-red-50",high:"border-orange-500 bg-orange-50",medium:"border-yellow-500 bg-yellow-50",low:"border-gray-500 bg-gray-50"};return s[e]||s.medium},b=e=>{let s=new Date,a=new Date(e),l=s.getTime()-a.getTime(),t=Math.floor(l/6e4),i=Math.floor(l/36e5);return t<1?"Ahora":t<60?"Hace ".concat(t,"m"):i<24?"Hace ".concat(i,"h"):"Hace ".concat(Math.floor(l/864e5),"d")};return s?(0,l.jsxs)("div",{ref:g,className:(0,E.cn)("absolute right-0 mt-2 w-96 bg-white rounded-lg shadow-xl border z-50 max-h-[80vh] overflow-hidden",r),children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-4 border-b bg-gray-50",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(z.Z,{className:"w-5 h-5"}),(0,l.jsx)("h3",{className:"font-semibold text-gray-900",children:"Notificaciones"}),c>0&&(0,l.jsx)("span",{className:"bg-red-500 text-white text-xs px-2 py-1 rounded-full",children:c})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)("button",{onClick:N,disabled:0===c,className:"p-1 hover:bg-gray-200 rounded disabled:opacity-50",title:"Marcar todas como le\xeddas",children:(0,l.jsx)(A.Z,{className:"w-4 h-4"})}),(0,l.jsx)("button",{onClick:a,className:"p-1 hover:bg-gray-200 rounded",children:(0,l.jsx)(T.Z,{className:"w-4 h-4"})})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2 p-3 border-b bg-gray-50",children:[(0,l.jsx)(G.Z,{className:"w-4 h-4 text-gray-500"}),(0,l.jsxs)("select",{value:u,onChange:e=>h(e.target.value),className:"text-sm border rounded px-2 py-1 bg-white",children:[(0,l.jsx)("option",{value:"all",children:"Todas"}),(0,l.jsx)("option",{value:"unread",children:"No le\xeddas"}),(0,l.jsx)("option",{value:"read",children:"Le\xeddas"})]}),(0,l.jsxs)("select",{value:p,onChange:e=>j(e.target.value),className:"text-sm border rounded px-2 py-1 bg-white",children:[(0,l.jsx)("option",{value:"all",children:"Todas las prioridades"}),(0,l.jsx)("option",{value:"critical",children:"Cr\xedticas"}),(0,l.jsx)("option",{value:"high",children:"Altas"}),(0,l.jsx)("option",{value:"medium",children:"Medias"}),(0,l.jsx)("option",{value:"low",children:"Bajas"})]})]}),(0,l.jsx)("div",{className:"max-h-96 overflow-y-auto",children:o?(0,l.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):0===n.length?(0,l.jsxs)("div",{className:"text-center p-8 text-gray-500",children:[(0,l.jsx)(z.Z,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),(0,l.jsx)("p",{children:"No hay notificaciones"})]}):(0,l.jsx)("div",{className:"divide-y",children:n.map(e=>(0,l.jsx)("div",{className:(0,E.cn)("p-4 hover:bg-gray-50 cursor-pointer transition-colors",!e.esta_leido&&"bg-blue-50"),onClick:()=>v(e.id),children:(0,l.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,l.jsx)("div",{className:(0,E.cn)("w-2 h-2 rounded-full mt-2 flex-shrink-0",e.esta_leido?"bg-gray-300":"bg-blue-500")}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-1",children:[(0,l.jsx)("h4",{className:"text-sm font-medium text-gray-900 truncate",children:e.titulo}),(0,l.jsx)("span",{className:(0,E.cn)("px-2 py-0.5 text-xs rounded-full border",f(e.prioridad)),children:e.prioridad})]}),(0,l.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2",children:e.mensaje}),(0,l.jsxs)("div",{className:"flex items-center justify-between mt-2",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500",children:b(e.creado_en)}),!e.esta_leido&&(0,l.jsx)("button",{onClick:s=>{s.stopPropagation(),v(e.id)},className:"text-xs text-blue-600 hover:text-blue-800",children:"Marcar como le\xedda"})]})]})]})},e.id))})}),(0,l.jsx)("div",{className:"p-3 border-t bg-gray-50",children:(0,l.jsxs)("button",{onClick:i,className:"flex items-center space-x-2 text-sm text-gray-600 hover:text-gray-800 w-full",children:[(0,l.jsx)(I.Z,{className:"w-4 h-4"}),(0,l.jsx)("span",{children:"Configurar notificaciones"})]})})]}):null},L=a(2442),D=a(1827),q=a(290),F=e=>{let{isOpen:s,onClose:a,onOpenPreferences:i}=e,{notifications:r,unreadCount:n,loading:c,markAsRead:o,markAllAsRead:d,fetchNotifications:x}=(0,P.useNotifications)(),[m,u]=(0,t.useState)("all"),[h,p]=(0,t.useState)("all"),[j,g]=(0,t.useState)("all"),[v,N]=(0,t.useState)(""),[f,b]=(0,t.useState)(new Set),[y,w]=(0,t.useState)(!1);(0,t.useEffect)(()=>{s&&x({filter:m,priority:"all"===h?void 0:h,type:"all"===j?void 0:j})},[s,m,h,j,x]),(0,t.useEffect)(()=>{s||(b(new Set),w(!1),N(""))},[s]);let C=async e=>{try{await o(e)}catch(e){console.error("Failed to mark notification as read:",e)}},k=async()=>{try{await d()}catch(e){console.error("Failed to mark all notifications as read:",e)}},S=async()=>{for(let e of Array.from(f))await C(e);b(new Set),w(!1)},Z=e=>{let s=new Set(f);s.has(e)?s.delete(e):s.add(e),b(s),w(s.size>0)},_=r.filter(e=>""===v||e.titulo.toLowerCase().includes(v.toLowerCase())||e.mensaje.toLowerCase().includes(v.toLowerCase())),M=e=>{let s={critical:"border-red-500 bg-red-50 text-red-700",high:"border-orange-500 bg-orange-50 text-orange-700",medium:"border-yellow-500 bg-yellow-50 text-yellow-700",low:"border-gray-500 bg-gray-50 text-gray-700"};return s[e]||s.medium},H=e=>{let s=new Date,a=new Date(e),l=s.getTime()-a.getTime(),t=Math.floor(l/6e4),i=Math.floor(l/36e5),r=Math.floor(l/864e5);return t<1?"Ahora":t<60?"Hace ".concat(t,"m"):i<24?"Hace ".concat(i,"h"):r<7?"Hace ".concat(r,"d"):a.toLocaleDateString()};return s?(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-start justify-center p-4 bg-black bg-opacity-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)(z.Z,{className:"w-6 h-6"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Centro de Notificaciones"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:n>0?"".concat(n," sin leer"):"Todas le\xeddas"})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[y&&(0,l.jsx)("div",{className:"flex items-center space-x-2 mr-4",children:(0,l.jsxs)("button",{onClick:S,className:"flex items-center space-x-2 px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 text-sm",children:[(0,l.jsx)(L.Z,{className:"w-4 h-4"}),(0,l.jsxs)("span",{children:["Marcar como le\xeddas (",f.size,")"]})]})}),(0,l.jsx)("button",{onClick:k,disabled:0===n,className:"p-2 hover:bg-gray-100 rounded disabled:opacity-50",title:"Marcar todas como le\xeddas",children:(0,l.jsx)(A.Z,{className:"w-5 h-5"})}),(0,l.jsx)("button",{onClick:i,className:"p-2 hover:bg-gray-100 rounded",title:"Configurar notificaciones",children:(0,l.jsx)(I.Z,{className:"w-5 h-5"})}),(0,l.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded",children:(0,l.jsx)(T.Z,{className:"w-5 h-5"})})]})]}),(0,l.jsx)("div",{className:"p-4 border-b bg-gray-50",children:(0,l.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,l.jsxs)("div",{className:"relative flex-1 min-w-[200px]",children:[(0,l.jsx)(D.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),(0,l.jsx)("input",{type:"text",placeholder:"Buscar notificaciones...",value:v,onChange:e=>N(e.target.value),className:"w-full pl-10 pr-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsx)(G.Z,{className:"w-4 h-4 text-gray-500"}),(0,l.jsxs)("select",{value:m,onChange:e=>u(e.target.value),className:"border rounded px-3 py-2 text-sm",children:[(0,l.jsx)("option",{value:"all",children:"Todas"}),(0,l.jsx)("option",{value:"unread",children:"No le\xeddas"}),(0,l.jsx)("option",{value:"read",children:"Le\xeddas"})]}),(0,l.jsxs)("select",{value:h,onChange:e=>p(e.target.value),className:"border rounded px-3 py-2 text-sm",children:[(0,l.jsx)("option",{value:"all",children:"Todas las prioridades"}),(0,l.jsx)("option",{value:"critical",children:"Cr\xedticas"}),(0,l.jsx)("option",{value:"high",children:"Altas"}),(0,l.jsx)("option",{value:"medium",children:"Medias"}),(0,l.jsx)("option",{value:"low",children:"Bajas"})]}),(0,l.jsxs)("select",{value:j,onChange:e=>g(e.target.value),className:"border rounded px-3 py-2 text-sm",children:[(0,l.jsx)("option",{value:"all",children:"Todos los tipos"}),(0,l.jsx)("option",{value:"mensaje",children:"Mensajes"}),(0,l.jsx)("option",{value:"cotizacion",children:"Cotizaciones"}),(0,l.jsx)("option",{value:"servicio",children:"Servicios"}),(0,l.jsx)("option",{value:"pago",children:"Pagos"}),(0,l.jsx)("option",{value:"sistema",children:"Sistema"})]})]}),(0,l.jsx)("div",{className:"flex items-center space-x-2",children:(0,l.jsx)("button",{onClick:()=>{f.size===r.length?(b(new Set),w(!1)):(b(new Set(r.map(e=>e.id))),w(!0))},className:"px-3 py-2 text-sm border rounded hover:bg-gray-100",children:f.size===r.length?"Deseleccionar todo":"Seleccionar todo"})})]})}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto max-h-[60vh]",children:c?(0,l.jsx)("div",{className:"flex items-center justify-center p-12",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):0===_.length?(0,l.jsxs)("div",{className:"text-center p-12 text-gray-500",children:[(0,l.jsx)(z.Z,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),(0,l.jsx)("h3",{className:"text-lg font-medium mb-2",children:"No hay notificaciones"}),(0,l.jsx)("p",{children:"Las notificaciones aparecer\xe1n aqu\xed cuando las recibas."})]}):(0,l.jsx)("div",{className:"divide-y",children:_.map(e=>(0,l.jsx)("div",{className:(0,E.cn)("p-4 hover:bg-gray-50 transition-colors border-l-4",!e.esta_leido&&"bg-blue-50",f.has(e.id)&&"bg-blue-100","critical"===e.prioridad&&"border-red-500","high"===e.prioridad&&"border-orange-500","medium"===e.prioridad&&"border-yellow-500","low"===e.prioridad&&"border-gray-500"),children:(0,l.jsxs)("div",{className:"flex items-start space-x-4",children:[(0,l.jsx)("input",{type:"checkbox",checked:f.has(e.id),onChange:()=>Z(e.id),className:"mt-1"}),(0,l.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-2 mb-2",children:[(0,l.jsx)("h3",{className:"text-sm font-medium text-gray-900 truncate",children:e.titulo}),(0,l.jsx)("span",{className:(0,E.cn)("px-2 py-1 text-xs rounded-full border",M(e.prioridad)),children:e.prioridad}),(0,l.jsx)("span",{className:"text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded",children:e.tipo})]}),(0,l.jsx)("p",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.mensaje}),(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("span",{className:"text-xs text-gray-500",children:H(e.creado_en)}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[!e.esta_leido&&(0,l.jsx)("button",{onClick:()=>C(e.id),className:"text-xs text-blue-600 hover:text-blue-800",children:"Marcar como le\xedda"}),(0,l.jsx)("button",{className:"p-1 hover:bg-gray-200 rounded",children:(0,l.jsx)(q.Z,{className:"w-4 h-4"})})]})]})]})]})},e.id))})})]})}):null},R=a(1271),Y=a(1295),O=a(2882),B=a(6245),U=e=>{let{isOpen:s,onClose:a}=e,{preferences:i,fetchPreferences:r,updatePreferences:n}=(0,P.useNotifications)(),[c,o]=(0,t.useState)({}),[d,x]=(0,t.useState)(!1),[m,u]=(0,t.useState)(!1);(0,t.useEffect)(()=>{s&&!i&&r().catch(console.error)},[s,i,r]),(0,t.useEffect)(()=>{i&&o({...i})},[i]);let h=async()=>{u(!0);try{await n(c),a()}catch(e){console.error("Failed to save preferences:",e)}finally{u(!1)}},p=(e,s)=>{o(a=>({...a,[e]:s}))},j=(e,s)=>{o(a=>({...a,canales:{...a.canales,[e]:s}}))},g=(e,s,a)=>{o(l=>{var t;return{...l,categorias:{...l.categorias,[e]:{...null===(t=l.categorias)||void 0===t?void 0:t[e],[s]:a}}}})},v=[{value:"push",label:"Push",icon:(0,l.jsx)(R.Z,{className:"w-4 h-4"})},{value:"email",label:"Email",icon:(0,l.jsx)(Y.Z,{className:"w-4 h-4"})},{value:"sms",label:"SMS",icon:(0,l.jsx)(O.Z,{className:"w-4 h-4"})},{value:"in_app",label:"En App",icon:(0,l.jsx)(z.Z,{className:"w-4 h-4"})}];return s?(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50",children:(0,l.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] overflow-hidden",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,l.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,l.jsx)(I.Z,{className:"w-6 h-6"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Preferencias de Notificaciones"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Configura c\xf3mo quieres recibir tus notificaciones"})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,l.jsxs)("button",{onClick:h,disabled:m,className:"flex items-center space-x-2 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:[(0,l.jsx)(B.Z,{className:"w-4 h-4"}),(0,l.jsx)("span",{children:m?"Guardando...":"Guardar"})]}),(0,l.jsx)("button",{onClick:a,className:"p-2 hover:bg-gray-100 rounded",children:(0,l.jsx)(T.Z,{className:"w-5 h-5"})})]})]}),(0,l.jsx)("div",{className:"flex-1 overflow-y-auto max-h-[70vh] p-6",children:d?(0,l.jsx)("div",{className:"flex items-center justify-center p-12",children:(0,l.jsx)("div",{className:"animate-spin rounded-full h-10 w-10 border-b-2 border-blue-500"})}):(0,l.jsxs)("div",{className:"space-y-8",children:[(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Configuraci\xf3n General"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Zona Horaria"}),(0,l.jsxs)("select",{value:c.timezone||"America/Buenos_Aires",onChange:e=>p("timezone",e.target.value),className:"w-full border rounded px-3 py-2",children:[(0,l.jsx)("option",{value:"America/Buenos_Aires",children:"Buenos Aires (GMT-3)"}),(0,l.jsx)("option",{value:"America/Sao_Paulo",children:"S\xe3o Paulo (GMT-3)"}),(0,l.jsx)("option",{value:"America/Mexico_City",children:"Ciudad de M\xe9xico (GMT-6)"}),(0,l.jsx)("option",{value:"America/New_York",children:"Nueva York (GMT-5)"}),(0,l.jsx)("option",{value:"Europe/Madrid",children:"Madrid (GMT+1)"}),(0,l.jsx)("option",{value:"Europe/London",children:"Londres (GMT+0)"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Frecuencia de Resumen"}),(0,l.jsxs)("select",{value:c.summary_frequency||"immediate",onChange:e=>p("summary_frequency",e.target.value),className:"w-full border rounded px-3 py-2",children:[(0,l.jsx)("option",{value:"immediate",children:"Inmediato"}),(0,l.jsx)("option",{value:"hourly",children:"Cada hora"}),(0,l.jsx)("option",{value:"daily",children:"Diario"})]})]})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:!1!==c.enabled,onChange:e=>p("enabled",e.target.checked),className:"rounded"}),(0,l.jsx)("span",{className:"text-sm text-gray-700",children:"Notificaciones habilitadas"})]}),(0,l.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:!1!==c.group_similar,onChange:e=>p("group_similar",e.target.checked),className:"rounded"}),(0,l.jsx)("span",{className:"text-sm text-gray-700",children:"Agrupar notificaciones similares"})]}),(0,l.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:!1!==c.sound_enabled,onChange:e=>p("sound_enabled",e.target.checked),className:"rounded"}),(0,l.jsx)("span",{className:"text-sm text-gray-700",children:"Sonido habilitado"})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("h3",{className:"text-lg font-medium text-gray-900 flex items-center space-x-2",children:[(0,l.jsx)(f.Z,{className:"w-5 h-5"}),(0,l.jsx)("span",{children:"Horas de Silencio"})]}),(0,l.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:c.quiet_hours_enabled||!1,onChange:e=>p("quiet_hours_enabled",e.target.checked),className:"rounded"}),(0,l.jsx)("span",{className:"text-sm text-gray-700",children:"Habilitar horas de silencio"})]}),c.quiet_hours_enabled&&(0,l.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ml-6",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hora de Inicio"}),(0,l.jsx)("input",{type:"time",value:c.quiet_start_time||"22:00",onChange:e=>p("quiet_start_time",e.target.value),className:"border rounded px-3 py-2"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Hora de Fin"}),(0,l.jsx)("input",{type:"time",value:c.quiet_end_time||"08:00",onChange:e=>p("quiet_end_time",e.target.value),className:"border rounded px-3 py-2"})]})]})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Canales de Notificaci\xf3n"}),(0,l.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:v.map(e=>{var s,a;return(0,l.jsxs)("label",{className:(0,E.cn)("flex items-center space-x-2 p-3 border rounded cursor-pointer hover:bg-gray-50",(null===(s=c.canales)||void 0===s?void 0:s[e.value])&&"bg-blue-50 border-blue-200"),children:[(0,l.jsx)("input",{type:"checkbox",checked:(null===(a=c.canales)||void 0===a?void 0:a[e.value])||!1,onChange:s=>j(e.value,s.target.checked),className:"rounded"}),e.icon,(0,l.jsx)("span",{className:"text-sm font-medium",children:e.label})]},e.value)})})]}),(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Categor\xedas de Notificaci\xf3n"}),(0,l.jsx)("div",{className:"space-y-4",children:[{value:"mensaje",label:"Mensajes",description:"Mensajes directos y conversaciones"},{value:"cotizacion",label:"Cotizaciones",description:"Solicitudes de presupuesto y ofertas"},{value:"servicio",label:"Servicios",description:"Actualizaciones de servicios y estado"},{value:"pago",label:"Pagos",description:"Confirmaciones y actualizaciones de pago"},{value:"sistema",label:"Sistema",description:"Notificaciones del sistema y mantenimiento"},{value:"urgente",label:"Urgentes",description:"Alertas cr\xedticas y emergencias"},{value:"recordatorio",label:"Recordatorios",description:"Recordatorios de citas y tareas"}].map(e=>{var s,a,t,i,r,n,o;return(0,l.jsxs)("div",{className:"border rounded p-4",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"font-medium text-gray-900",children:e.label}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:e.description})]}),(0,l.jsxs)("label",{className:"flex items-center space-x-2",children:[(0,l.jsx)("input",{type:"checkbox",checked:(null===(a=c.categorias)||void 0===a?void 0:null===(s=a[e.value])||void 0===s?void 0:s.enabled)!==!1,onChange:s=>g(e.value,"enabled",s.target.checked),className:"rounded"}),(0,l.jsx)("span",{className:"text-sm",children:"Habilitado"})]})]}),(null===(i=c.categorias)||void 0===i?void 0:null===(t=i[e.value])||void 0===t?void 0:t.enabled)&&(0,l.jsx)("div",{className:"ml-4 space-y-2",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Prioridades m\xednimas"}),(0,l.jsxs)("select",{value:(null===(o=c.categorias)||void 0===o?void 0:null===(n=o[e.value])||void 0===n?void 0:null===(r=n.priority)||void 0===r?void 0:r[0])||"low",onChange:s=>g(e.value,"priority",[s.target.value]),className:"border rounded px-3 py-1 text-sm",children:[(0,l.jsx)("option",{value:"low",children:"Baja o superior"}),(0,l.jsx)("option",{value:"medium",children:"Media o superior"}),(0,l.jsx)("option",{value:"high",children:"Alta o superior"}),(0,l.jsx)("option",{value:"critical",children:"Solo cr\xedticas"})]})]})})]},e.value)})})]})]})})]})}):null};let V={id:"service-1",descripcion:"Limpieza general del hogar",cliente_id:"client-1",profesional_id:"prof-1",estado:"aceptado",es_urgente:!1,cliente:{id:"client-1",nombre:"Juan P\xe9rez",email:"juan@example.com"},profesional:{id:"prof-1",nombre:"Mar\xeda Gonz\xe1lez",email:"maria@example.com",perfil_profesional:{tarifa_hora:1500}}};function J(){let[e,s]=(0,t.useState)("selection"),[a,i]=(0,t.useState)(null),[r,n]=(0,t.useState)(null),[d,x]=(0,t.useState)(!1),[m,p]=(0,t.useState)(!1),[j,g]=(0,t.useState)(!1),N=e=>{i(e),s("checkout")},f=e=>{n(e),s("status")},b=[{id:"selection",label:"Seleccionar Servicio",icon:h.Z},{id:"checkout",label:"Checkout",icon:h.Z},{id:"status",label:"Estado del Pago",icon:u.Z},{id:"history",label:"Historial",icon:C.Z}];return(0,l.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,l.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-8",children:[(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Pagos - Cliente"}),(0,l.jsx)("p",{className:"text-gray-600 mt-2",children:"Gestiona tus pagos y servicios"})]}),(0,l.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)(M,{onClick:()=>x(!d)}),(0,l.jsx)(H,{isOpen:d,onClose:()=>x(!1),onOpenPreferences:()=>{x(!1),g(!0)}})]}),"selection"!==e&&(0,l.jsxs)(o.z,{variant:"outline",onClick:()=>s("selection"),children:[(0,l.jsx)(_.Z,{className:"w-4 h-4 mr-2"}),"Volver al Inicio"]})]})]})}),(0,l.jsx)("div",{className:"mb-8",children:(0,l.jsx)("div",{className:"flex items-center justify-center space-x-4",children:b.map((s,a)=>{let t=s.icon,i=s.id===e,r=b.findIndex(s=>s.id===e)>a;return(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)("div",{className:"\n                    flex items-center justify-center w-10 h-10 rounded-full border-2\n                    ".concat(i?"border-primary-500 bg-primary-50":"","\n                    ").concat(r?"border-success-500 bg-success-500":"","\n                    ").concat(i||r?"":"border-gray-300","\n                  "),children:r?(0,l.jsx)(u.Z,{className:"w-5 h-5 text-white"}):(0,l.jsx)(t,{className:"w-5 h-5 ".concat(i?"text-primary-600":"text-gray-400")})}),(0,l.jsx)("span",{className:"ml-2 text-sm font-medium ".concat(i?"text-primary-600":"text-gray-600"),children:s.label}),a<b.length-1&&(0,l.jsx)("div",{className:"w-12 h-0.5 mx-4 ".concat(r?"bg-success-500":"bg-gray-300")})]},s.id)})})}),(0,l.jsx)("div",{className:"bg-white rounded-lg shadow-sm",children:(()=>{switch(e){case"selection":var t;return(0,l.jsxs)("div",{className:"space-y-6",children:[(0,l.jsxs)("div",{className:"text-center",children:[(0,l.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Seleccionar Servicio para Pagar"}),(0,l.jsx)("p",{className:"text-gray-600",children:"Elige el servicio que deseas pagar"})]}),(0,l.jsx)("div",{className:"grid gap-4 max-w-2xl mx-auto",children:(0,l.jsx)(c.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>N(V),children:(0,l.jsx)(c.aY,{className:"p-6",children:(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"font-medium text-gray-900",children:V.descripcion}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["Profesional: ",V.profesional.nombre]}),(0,l.jsxs)("p",{className:"text-sm text-gray-600",children:["Tarifa: $",null===(t=V.profesional.perfil_profesional)||void 0===t?void 0:t.tarifa_hora,"/hora"]})]}),(0,l.jsx)(o.z,{children:"Seleccionar"})]})})})})]});case"checkout":return a?(0,l.jsx)(v,{service:a,onSuccess:f,onCancel:()=>s("selection")}):null;case"status":return r?(0,l.jsx)(w,{paymentId:r,onStatusChange:e=>{"approved"===e.status||e.status}}):null;case"history":return(0,l.jsx)(Z,{clientId:"client-1"});default:return null}})()}),(0,l.jsx)("div",{className:"mt-8 flex justify-center",children:(0,l.jsx)("div",{className:"flex space-x-4",children:"history"!==e&&(0,l.jsxs)(o.z,{variant:"outline",onClick:()=>s("history"),children:[(0,l.jsx)(C.Z,{className:"w-4 h-4 mr-2"}),"Ver Historial"]})})})]}),(0,l.jsx)(F,{isOpen:m,onClose:()=>p(!1),onOpenPreferences:()=>{p(!1),g(!0)}}),(0,l.jsx)(U,{isOpen:j,onClose:()=>g(!1)})]})}}},function(e){e.O(0,[216,592,744],function(){return e(e.s=4404)}),_N_E=e.O()}]);